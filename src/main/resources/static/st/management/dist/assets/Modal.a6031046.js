var e=Object.defineProperty,t=Object.prototype.hasOwnProperty,a=Object.getOwnPropertySymbols,o=Object.prototype.propertyIsEnumerable,r=(t,a,o)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[a]=o,l=(e,l)=>{for(var s in l||(l={}))t.call(l,s)&&r(e,s,l[s]);if(a)for(var s of a(l))o.call(l,s)&&r(e,s,l[s]);return e},s=(e,t,a)=>new Promise(((o,r)=>{var l=e=>{try{n(a.next(e))}catch(t){r(t)}},s=e=>{try{n(a.throw(e))}catch(t){r(t)}},n=e=>e.done?o(e.value):Promise.resolve(e.value).then(l,s);n((a=a.apply(e,t)).next())}));import{e as n,q as i,dz as d,k as u,w as c,dB as p,z as m,d_ as f,d$ as h,dG as g,dH as b,r as v,o as w,m as y,n as I,ar as _,bz as M,E as O}from"./index.e3ab3d33.js";import{_ as R,a as x}from"./useModal.ee72b48f.js";import{g as F,U,h as j}from"./useForm.4c49c850.js";function P(){return[{title:"id",dataIndex:"id",width:100,defaultHidden:!0},{title:"photoRoute",dataIndex:"photoRoute",width:100,defaultHidden:!0},{title:"商品名称",dataIndex:"goodsName",width:100},{title:"头像",dataIndex:"photo",width:120,slots:{customRender:"photo"}},{title:"积分数",width:70,dataIndex:"integral"},{title:"商品描述",dataIndex:"goodsDesc",width:150}]}const B=[{field:"id",label:"id",component:"Input",show:!1},{field:"goodsName",label:"商品名称",component:"Input",required:!0},{field:"integral",label:"价值积分数",component:"Input",required:!0},{label:"商品描述",field:"goodsDesc",component:"InputTextArea",required:!0},{label:"photoRoute",field:"photoRoute",component:"Input",show:!1}];var L=n({name:"Modal",components:{BasicModal:R,BasicForm:F,Upload:U},emits:["success"],setup(e,{emit:t}){const a=i([]),o=i(""),r=i(!0),{VITE_GLOB_API_URL:n}=d(),{createMessage:g}=m(),[b,{setFieldsValue:v,resetFields:w,validate:y,getFieldsValue:I}]=j({labelWidth:100,schemas:B,showActionButtonGroup:!1,actionColOptions:{span:23}}),[_,{setModalProps:M,closeModal:O}]=x((e=>s(this,null,(function*(){w(),M({confirmLoading:!1}),r.value=!!(null==e?void 0:e.isUpdate),o.value="",c(r)&&(o.value=`data:image/png;base64,${e.record.photo}`,v(l({},e.record)))})))),R=u((()=>c(r)?"编辑商品":"新增商品"));return{registerModal:_,registerForm:b,handleSubmit:function(){return s(this,null,(function*(){let e={},s="";c(r)?(e=I(),s=f):(e=yield y(),s=h);try{if(!o.value)return g.warning("请上传商品图片");M({confirmLoading:!0});const i=l({},e),d=new FormData;Object.keys(i).forEach((e=>{d.append(e,i[e])})),d.append("photoFile",a.value);200===(yield p({url:n+s,method:"post",data:d,headers:{"Content-Type":"multipart/form-data"}})).data.code&&(g.success(c(r)?"修改成功！":"新增成功！"),O(),t("success"))}finally{M({confirmLoading:!1})}}))},fileList:a,imageUrl:o,beforeUpload:e=>new Promise(((t,r)=>e.size/1024/1024<4?(function(e){return new Promise(((t,a)=>{const o=new FileReader;o.readAsDataURL(e),o.onload=()=>t({result:o.result,file:e}),o.onerror=e=>a(e)}))}(e).then((({result:e})=>{o.value=e})),a.value=e,r(!1)):(g.error("只能上传不超过4MB的文件!"),r(!1)))),getTitle:R}}});const k=M("data-v-fc71f72c");g("data-v-fc71f72c");const T=I("label",{class:"ml-10 mr-5 ant-form-item-required ant-form-item-no-colon"},"请上传商品图片",-1),q=O(" 选择文件 ");b();const z=k(((e,t,a,o,r,l)=>{const s=v("BasicForm"),n=v("upload-outlined"),i=v("a-button"),d=v("Upload"),u=v("BasicModal");return w(),y(u,_({height:340},e.$attrs,{onRegister:e.registerModal,title:e.getTitle,onOk:e.handleSubmit}),{default:k((()=>[I(s,{onRegister:e.registerForm},null,8,["onRegister"]),T,I(d,{"file-list":e.fileList,name:"avatar",class:"avatar-uploader","show-upload-list":!1,"before-upload":e.beforeUpload},{default:k((()=>[e.imageUrl?(w(),y("img",{key:0,src:e.imageUrl,alt:"avatar"},null,8,["src"])):(w(),y(i,{key:1,type:"primary"},{default:k((()=>[I(n),q])),_:1}))])),_:1},8,["file-list","before-upload"])])),_:1},16,["onRegister","title","onOk"])}));L.render=z,L.__scopeId="data-v-fc71f72c";var S=Object.freeze({__proto__:null,[Symbol.toStringTag]:"Module",default:L});export{S as M,L as _,P as g};
