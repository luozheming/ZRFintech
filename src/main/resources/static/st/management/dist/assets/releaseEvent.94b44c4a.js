var e=Object.defineProperty,t=Object.prototype.hasOwnProperty,a=Object.getOwnPropertySymbols,o=Object.prototype.propertyIsEnumerable,s=(t,a,o)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[a]=o,r=(e,r)=>{for(var i in r||(r={}))t.call(r,i)&&s(e,i,r[i]);if(a)for(var i of a(r))o.call(r,i)&&s(e,i,r[i]);return e},i=(e,t,a)=>new Promise(((o,s)=>{var r=e=>{try{n(a.next(e))}catch(t){s(t)}},i=e=>{try{n(a.throw(e))}catch(t){s(t)}},n=e=>e.done?o(e.value):Promise.resolve(e.value).then(r,i);n((a=a.apply(e,t)).next())}));import{e as n,dy as l,q as d,dz as p,ag as u,dA as c,dB as m,dC as f,z as b,bE as j,ax as y,r as g,o as v,m as h,n as w,D as x,E as C}from"./index.e3ab3d33.js";import{s as O}from"./data.7be61905.js";import{g as F,U as P,j as U,h as _}from"./useForm.4c49c850.js";import"./vendor.afa0338c.js";import"./index.c9e49986.js";import"./index.ec624549.js";import"./responsiveObserve.c545f1cc.js";import"./_baseIteratee.3a82d812.js";import"./get.92310d4b.js";import"./index.002624d4.js";import"./index.40de8c80.js";import"./index.69962a4d.js";import"./warning.0b2da52a.js";import"./index.2561698d.js";import"./CountdownInput.4bcf5023.js";import"./useModal.ee72b48f.js";import"./useWindowSizeFn.24a861a8.js";import"./FullscreenOutlined.b1e97c8e.js";import"./index.5a1e8da2.js";import"./RedoOutlined.2b7b81e2.js";import"./download.00911bd8.js";import"./index.dfffa629.js";var B=n({components:{BasicForm:F,CollapseContainer:l,Upload:P,[U.name]:U},setup(){const e=d([]),t=d(""),{VITE_GLOB_API_URL:a}=p(),{createMessage:o}=b(),{closeCurrent:s}=j(),n=y(),[l,{validate:g,setProps:v,getFieldsValue:h,setFieldsValue:w}]=_({labelCol:{span:10},wrapperCol:{span:14},baseColProps:{span:6},schemas:O,actionColOptions:{offset:8},showActionButtonGroup:!1});u((()=>{x()}));const x=()=>i(this,null,(function*(){const e=yield c("");t.value=e.photo?`data:image/png;base64,${e.photo}`:null,w(r({},e))}));return{register:l,fileList:e,imageUrl:t,beforeUpload:a=>new Promise(((s,r)=>a.size/1024/1024<4?(function(e){return new Promise(((t,a)=>{const o=new FileReader;o.readAsDataURL(e),o.onload=()=>t({result:o.result,file:e}),o.onerror=e=>a(e)}))}(a).then((({result:e})=>{t.value=e})),e.value=a,r(!1)):(o.error("只能上传不超过4MB的文件!"),r(!1)))),submit:function(l){return i(this,null,(function*(){const i={isDone:l};if(!t.value)return o.warning("请上传图片");try{let t=yield g();t=h();const l=r(r({},t),i);v({submitButtonOptions:{loading:!0}});const d=new FormData;Object.keys(l).forEach((e=>{d.append(e,l[e])})),d.append("photoFile",e.value);200===(yield m({url:a+f,method:"post",data:d,headers:{"Content-Type":"multipart/form-data"}})).data.code&&(v({submitButtonOptions:{loading:!1}}),o.success("提交成功！"),s(),n("/activities/projectManagement"))}catch(d){}}))}}}});const R={class:"p-4"},k=C(" 选择文件 "),E={class:"flex items-center justify-center"},I=C("保存"),L=C("提交");B.render=function(e,t,a,o,s,r){const i=g("a-image"),n=g("upload-outlined"),l=g("a-button"),d=g("Upload"),p=g("BasicForm"),u=g("CollapseContainer");return v(),h("div",R,[w(u,{title:"发布活动"},{default:x((()=>[w(p,{onRegister:e.register},{customSlot:x((()=>[w(d,{"file-list":e.fileList,name:"avatar","show-upload-list":!1,"before-upload":e.beforeUpload},{default:x((()=>[e.imageUrl?(v(),h(i,{key:0,src:e.imageUrl,width:200},null,8,["src"])):(v(),h(l,{key:1,type:"primary"},{default:x((()=>[w(n),k])),_:1}))])),_:1},8,["file-list","before-upload"])])),_:1},8,["onRegister"]),w("div",E,[w(l,{class:"mr-5",onClick:t[1]||(t[1]=t=>e.submit(!1))},{default:x((()=>[I])),_:1}),w(l,{type:"primary",onClick:t[2]||(t[2]=t=>e.submit(!0))},{default:x((()=>[L])),_:1})])])),_:1})])};export default B;
